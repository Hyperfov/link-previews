!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var i=e();for(var s in i)("object"==typeof exports?exports:t)[s]=i[s]}}(self,(function(){return(()=>{"use strict";var t={};(t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})})(t);const e=t=>{let e=null;if("string"==typeof t){const i=document.querySelector(t);i instanceof HTMLElement?e=i:console.error(`HYPERFOV LINK PREVIEWS >> could not access element ${t}`)}else t instanceof HTMLElement?e=t:console.error("HYPERFOV LINK PREVIEWS >> unknown element type; must be a string or HTMLElement");return e};class i extends HTMLElement{static get observedAttributes(){return["parent","open","template","position","url","title","description","img","fetch","backend"]}constructor(){super(),this._shadow=this.attachShadow({mode:"open"}),this.render=this.render.bind(this),this.retrievePage=this.retrievePage.bind(this),this.getAttrOrDefault=this.getAttrOrDefault.bind(this),this.url=this.getAttrOrDefault("url",null),this.t=this.getAttrOrDefault("title",null),this.description=this.getAttrOrDefault("description",null),this.img=this.getAttrOrDefault("img",null),this.fetch=this.getAttrOrDefault("fetch",!0,(t=>"true"===t)),this.open=this.getAttrOrDefault("open",!1,(t=>"true"===t)),this.parentPos=this.getAttrOrDefault("parent",null,(t=>JSON.parse(t))),this.backend=this.getAttrOrDefault("backend",null),this.template=this.getAttrOrDefault("template",null),this.position=this.getAttrOrDefault("position",null),this.retrievedPage=!1,this.templateElt=null,this.render()}attributeChangedCallback(t){"parent"===t?this.parentPos=this.getAttrOrDefault(t,null,(t=>JSON.parse(t))):"open"===t?this.open=this.getAttrOrDefault(t,!1,(t=>"true"===t)):"fetch"===t?this.fetch=this.getAttrOrDefault(t,!0,(t=>"true"===t)):"title"===t?this.t=this.getAttrOrDefault(t,null):this[t]=this.getAttrOrDefault(t,null),this.render()}render(){if(this.parentPos&&this.open){!this.retrievedPage&&this.fetch&&this.backend&&this.retrievePage(),this.template&&!this.templateElt&&(this.templateElt=e(this.template)?.content,this._shadow.appendChild(this.templateElt.cloneNode(!0))),this.style.position="absolute",this.style.pointerEvents="none";const t=this.getBoundingClientRect(),i=this.parentPos.y-t.height<0,s=this.parentPos.bottom+t.height>window.innerHeight;"below"===this.position&&!s||"above"===this.position&&i?(this.style.left=`${this.parentPos.x}px`,this.style.top=`${this.parentPos.bottom+window.scrollY}px`):"above"===this.position&&!i||"below"===this.position&&s?(this.style.left=`${this.parentPos.x}px`,this.style.top=`${this.parentPos.y-t.height+window.scrollY}px`):"follow"===this.position&&(this.style.left=`${this.parentPos.x}px`,this.style.top=`${this.parentPos.y+window.scrollY+15}px`),this.style.transition="0.2s opacity ease-in",this.style.opacity=1,this.description&&!this.descriptionElt?(this.descriptionElt=document.createElement("span"),this.descriptionElt.id="description",this.descriptionElt.setAttribute("slot","description"),this.descriptionElt.textContent=this.description,this.appendChild(this.descriptionElt),this._shadow.querySelector("div").classList.add("has-description")):this.descriptionElt&&this.description!==this.descriptionElt.textContent&&(this.descriptionElt.textContent=this.description),this.t&&!this.titleElt?(this.titleElt=document.createElement("span"),this.titleElt.id="title",this.titleElt.setAttribute("slot","title"),this.titleElt.textContent=this.t,this.appendChild(this.titleElt),this._shadow.querySelector("div").classList.add("has-title")):this.titleElt&&this.t!==this.titleElt.textContent&&(this.titleElt.textContent=this.t),this.url&&!this.urlElt?(this.urlElt=document.createElement("span"),this.urlElt.id="url",this.urlElt.setAttribute("slot","url"),this.urlElt.textContent=this.url,this.appendChild(this.urlElt),this._shadow.querySelector("div").classList.add("has-url")):this.urlElt&&this.url!==this.urlElt.textContent&&(this.urlElt.textContent=this.url),this.img&&!this.imgElt?(this.imgElt=document.createElement("img"),this.imgElt.id="img",this.imgElt.setAttribute("slot","image"),this.imgElt.src=this.img,this.appendChild(this.imgElt),this._shadow.querySelector("div").classList.add("has-image")):this.imgElt&&this.img!==this.imgElt.src&&(this.imgElt.src=this.img)}else this.parentPos&&!this.open&&(this.style.opacity=0)}retrievePage(){this.retrievedPage=!0,fetch(`${this.backend}/?page=${this.url}`).then((t=>{t.ok&&t.json().then((t=>{t.title&&!this.t&&(this.t=t.title),t.description&&!this.description&&(this.description=t.description),t.image&&!this.img&&(this.img=t.image),this.render()}))}))}getAttrOrDefault(t,e,i=(t=>t)){if(this.hasAttribute(t))try{return i(this.getAttribute(t))}catch{console.error(`HYPERFOV LINK PREVIEWS >> could not parse attribute "${t}" with value ${val}`)}return e}}const s=i;return customElements.define("link-preview",s),console.log("HYPEFOV LINK PREVIEWS >> running"),window.linkPreview=function(t,i={}){const s={title:null,description:null,img:null,url:null,backend:null,fetchLink:!0,position:"below",template:"#hyperfov-link-preview-template",...i};!s.backend&&s.fetchLink&&console.error("HYPERFOV LINK PREVIEWS >> missing backend url");let n=e(t);if(!(i.template||document.querySelector(s.template)instanceof HTMLElement)){const t=document.createElement("div");t.innerHTML='\n<template id="hyperfov-link-preview-template">\n<p>my template</p>\n</template>\n',document.body.appendChild(t)}const l=document.createElement("link-preview");l.setAttribute("position",s.position),s.url?l.setAttribute("url",s.url):l.setAttribute("url",n.href),s.template&&l.setAttribute("template",s.template),s.description&&l.setAttribute("description",s.description),s.img&&l.setAttribute("img",s.img),s.title&&l.setAttribute("title",s.title),s.backend&&l.setAttribute("backend",s.backend),document.body.appendChild(l),n.addEventListener("mouseover",(()=>{const t=n.getBoundingClientRect();l.setAttribute("parent",JSON.stringify(t)),l.setAttribute("open","true")})),n.addEventListener("mouseout",(()=>{l.setAttribute("open",!1)})),"follow"===s.position&&n.addEventListener("mousemove",(t=>{const e={x:t.clientX,y:t.clientY};l.setAttribute("parent",JSON.stringify(e))}))},t})()}));