!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n=e();for(var i in n)("object"==typeof exports?exports:t)[i]=n[i]}}(self,(function(){return(()=>{"use strict";var t={d:(e,n)=>{for(var i in n)t.o(n,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:n[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{LinkPreview:()=>r,linkPreview:()=>l});const n=t=>{console.log(`HYPERFOV LINK PREVIEWS >> ${t}`)},i=t=>{console.error(`HYPERFOV LINK PREVIEWS >> ${t}`)},o=t=>{let e=null;if("string"==typeof t){const n=document.querySelector(t);n instanceof HTMLElement?e=n:i(`could not access element ${t}`)}else t instanceof HTMLElement||t instanceof SVGElement?e=t:i("unknown element type; must be a string or HTMLElement");return e};class s extends HTMLElement{static get observedAttributes(){return["parent","open","template","position","fetch","backend","content"]}constructor(){super(),this._shadow=this.attachShadow({mode:"open"}),this.render=this.render.bind(this),this.retrievePage=this.retrievePage.bind(this),this.getAttrOrDefault=this.getAttrOrDefault.bind(this),this.setContent=this.setContent.bind(this),this.setContent(),this.parentPos=this.getAttrOrDefault("parent",null,(t=>JSON.parse(t))),this.content=this.getAttrOrDefault("content",{},(t=>JSON.parse(t))),this.backend=this.getAttrOrDefault("backend",null),this.template=this.getAttrOrDefault("template",null),this.position=this.getAttrOrDefault("position",null),this.templateElt=null,this.elements={},this.retrievedPage=!1,this.render()}attributeChangedCallback(t){if("parent"===t)this.parentPos=this.getAttrOrDefault(t,null,(t=>JSON.parse(t)));else if("open"===t)this.open=this.getAttrOrDefault(t,!1,(t=>"true"===t));else if("fetch"===t)this.fetch=this.getAttrOrDefault(t,!0,(t=>"true"===t));else if("content"===t){const e=this.getAttrOrDefault(t,null,(t=>JSON.parse(t)));e?.href!==this.content?.href&&this.setContent(),this.content=e}else this[t]=this.getAttrOrDefault(t,null);this.render()}setContent(){this.content=this.getAttrOrDefault("content",null,(t=>JSON.parse(t)));for(const t in this.elements)this.removeChild(this.elements[t]),delete this.elements[t];this.retrievedPage=!1}render(){if(this.parentPos&&this.open){!this.retrievedPage&&this.fetch&&this.backend&&this.retrievePage(),this.template&&!this.templateElt&&(this.templateElt=o(this.template)?.content,this._shadow.appendChild(this.templateElt.cloneNode(!0))),this.style.position="absolute",this.style.pointerEvents="none";const t=this.getBoundingClientRect(),e=this.parentPos.y-t.height<0,n=this.parentPos.bottom+t.height>window.innerHeight;"below"===this.position&&!n||"above"===this.position&&e?(this.style.left=`${this.parentPos.x}px`,this.style.top=`${this.parentPos.bottom+window.scrollY}px`):"above"===this.position&&!e||"below"===this.position&&n?(this.style.left=`${this.parentPos.x}px`,this.style.top=`${this.parentPos.y-t.height+window.scrollY}px`):"follow"===this.position&&(this.style.left=`${this.parentPos.x}px`,this.style.top=`${this.parentPos.y+window.scrollY+15}px`),this.style.transition="0.2s opacity ease-in",this.style.opacity=1;for(const t in this.content)if(this.content[t]&&!this.elements[t]){const e="image"===t||"favicon"===t?document.createElement("img"):document.createElement("span");if(e.id=`lp-${t}`,e.setAttribute("slot",`lp-${t}`),"image"!==t&&"favicon"!==t)e.textContent=this.content[t],this.appendChild(e);else{const t=new Image;t.src=this.content.image,t.onload=n=>{e.src=t.src,this.appendChild(e),this.render()}}this.elements[t]=e}else(this.elements[t]&&this.elements[t]?.textContent!==this.content[t]||this.elements[t]&&this.elements[t]?.src!==this.content[t])&&("image"!==t&&"favicon"!==t?this.elements[t].textContent=this.content[t]:this.elements[t].src=this.content[t])}else this.parentPos&&!this.open&&(this.style.opacity=0)}retrievePage(){this.retrievedPage=!0,fetch(`${this.backend}/?page=${this.content?.href}`).then((t=>{t.ok&&t.json().then((t=>{for(const e in t)this.content[e]||(this.content[e]=t[e]);this.render()}))}))}getAttrOrDefault(t,e,n=(t=>t)){if(this.hasAttribute(t))try{return n(this.getAttribute(t))}catch{i(`could not parse attribute "${t}" with value ${val}`)}return e}}const r=s;function l(t,e={}){const s={content:{title:null,description:null,image:null,href:null},backend:null,fetch:!0,position:"below",template:"basic",...e};if(!window.matchMedia("(any-hover: hover)").matches)return void n("this device doesn't support hover events; will not any previews");!s.backend&&s.fetch&&i("missing backend url");let r=o(t);r.hasAttribute("href")||r.hasAttribute("xlink:href")||i("element missing href"),e.template&&"basic"!==s.template||(document.body.insertAdjacentHTML("afterbegin",'\n  <template id="hyperfov-link-preview-template">\n  <style>\n    .link-popup-wrapper {\n      border: var(--lp-border, none);\n      padding: var(--lp-padding, 10px);\n      background: var(--lp-background, white);\n      box-shadow: var(\n        --lp-box-shadow,\n        0px 5px 15px rgba(101, 101, 110, 0.3)\n      );\n      border-radius: var(--lp-border-radius, 6px);\n      max-width: var(--lp-max-width, 225px);\n      font-family: var(--lp-font-family, inherit);\n      font-weight: var(--lp-font-weight, normal);\n    }\n\n    .link-interior-content div:not(:last-child):not(:first-child) {\n      margin-top: 5px;\n      margin-bottom: 5px;\n    }\n\n    .link-image {\n      flex-shrink: 0;\n    }\n\n    .link-url {\n      text-overflow: ellipsis;\n      overflow: hidden;\n      white-space: nowrap;\n      font-weight: var(--lp-link-font-weight, normal);\n      color: var(--lp-link-color, grey);\n      font-size: var(--lp-link-font-size, 12px);\n      font-family: var(--lp-link-font-family, inherit);\n      border: var(--lp-link-border, none);\n    }\n\n    .link-title {\n      font-weight: var(--lp-title-font-weight, bold);\n      color: var(--lp-title-color, inherit);\n      font-size: var(--lp-title-font-size, 16px);\n      font-family: var(--lp-title-font-family, inherit);\n      border: var(--lp-title-border, none);\n    }\n\n    .link-description {\n      font-weight: var(--lp-description-font-weight, normal);\n      color: var(--lp-description-color, inherit);\n      font-size: var(--lp-description-font-size, 16px);\n      font-family: var(--lp-description-font-family, inherit);\n      border: var(--lp-description-border, none);\n    }\n\n    ::slotted(#lp-image) {\n      max-width: 100%;\n      border-radius: var(--lp-image-border-radius, 3px);\n      border: var(--lp-image-border, none);\n      width: max-content;\n      height: auto;\n      object-fit: cover;\n      object-position: top center;\n      max-height: var(--lp-image-max-height, 150px);\n      display: inline-block !important;\n      margin: 0 !important;\n    }\n\n    ::slotted(#lp-favicon) {\n      max-height: 14px;\n      max-width: 14px;\n      margin: 0 !important;\n      margin-right: 5px !important;\n      display: inline-block !important;\n      width: auto !important;\n    }\n  </style>\n  <div class="link-popup-wrapper">\n    <div class="link-interior-content">\n      <div class="link-image"><slot name="lp-image"></slot></div>\n      <div class="link-title">\n        <slot name="lp-favicon"></slot>\n        <slot name="lp-title"></slot>\n      </div>\n      <div class="link-description">\n        <slot name="lp-description"></slot>\n      </div>\n      <div class="link-url"><slot name="lp-href"></slot></div>\n    </div>\n  </div>\n</template>'),s.template="#hyperfov-link-preview-template");const l=document.createElement("link-preview");new MutationObserver(((t,e)=>{for(const e of t)if("href"===e.attributeName||"xlink:href"===e.attributeName){const t=r.getAttribute(e.attributeName);if(new RegExp(/https?:\/\//g).test(t))s.content.href=t;else{const e=new URL(window.location);e.pathname=t,s.content.href=e.href}l.setAttribute("content",JSON.stringify(s.content))}else if(e.attributeName.includes("lp-")){const t=e.attributeName.replace("lp-",""),n=r.getAttribute(e.attributeName);s.content[t]=n,l.setAttribute("content",JSON.stringify(s.content))}})).observe(r,{attributes:!0}),s.template&&l.setAttribute("template",s.template),s.backend&&l.setAttribute("backend",s.backend),s.position&&l.setAttribute("position",s.position),s.fetch&&l.setAttribute("fetch",s.fetch);for(const t of r.attributes)if("href"===t.nodeName||"xlink:href"===t.nodeName)if(new RegExp(/https?:\/\//g).test(t.nodeValue))s.content.href=t.nodeValue;else{const e=new URL(window.location);e.pathname=t.nodeValue,s.content.href=e.href}else{const e=t.nodeName.replace("lp-","").replace("xlink:","");s.content[e]=t.nodeValue}return l.setAttribute("content",JSON.stringify(s.content)),document.body.appendChild(l),r.addEventListener("mouseover",(()=>{const t=r.getBoundingClientRect();l.setAttribute("parent",JSON.stringify(t)),l.setAttribute("open","true")})),r.addEventListener("mouseout",(()=>{l.setAttribute("open",!1)})),"follow"===s.position&&r.addEventListener("mousemove",(t=>{const e={x:t.clientX,y:t.clientY};l.setAttribute("parent",JSON.stringify(e))})),l}return customElements.define("link-preview",r),n("running"),window.linkPreview=l,e})()}));